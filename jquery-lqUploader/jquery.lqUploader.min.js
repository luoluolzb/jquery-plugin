;(function($){var e=new Array();var g={'method':'post','uploadScript':'serverScript/upload.php','deleteScript':'serverScript/delete_file.php','uploadName':'fileData','maxFileSize':0,'typeList':[],'paramList':{},'deleteParamList':{},'showMessage':function(a){alert(a)},'onSelectFile':function(a){},'onMaxFileSize':function(a){g.showMessage('文件过大！')},'onTypeError':function(a){g.showMessage('文件类型错误！')},'onUploadSuccess':function(){},'onDeleteSuccess':function(){},'onUploadError':function(a){var b='上传出错！';if(msg.length>0){b+='错误描述：'+msg}g.showMessage(b)},'onDeleteError':function(a){var b='删除失败！';if(msg.length>0){b+='错误描述：'+msg}g.showMessage(b)},'handleUploadData':function(a){if(a.errcode==0){return{'result':true,'fileId':a.data['file_id'],'msg':a.data['msg'],}}else{return{'result':false,'fileId':'','msg':a.data['msg'],}}},'handleDeleteData':function(a){if(a.errcode==0){return{'result':true,'msg':a.data['msg'],}}else{return{'result':false,'msg':a.data['msg'],}}},};var n={'getSizeString':function(b){var c=function(a){if(a%1!=0){return a.toFixed(1)}else{return a}};if(b<1024){return b+'B'}else if(b<1048576){return c(b/1024)+'KB'}else{return c(b/1048576)+'MB'}},'addFile':function(a,b,c,d){var e=$('				<div class="lqUploader-file" data-file-id="'+d+'">					<span class="lqUploader-filename">						<i class="fa fa-'+n.getTypeClass(b)+'"></i> '+b+'					</span>					<span class="lqUploader-filesize">('+n.getSizeString(c)+')</span>					<span class="lqUploader-delete">删除</span>				</div>			');a.append(e)},'deleteFile':function(a,b){a.find('.lqUploader-file[data-file-id="'+b+'"]').remove()},'getFileType':function(a){var b=a.lastIndexOf(".");var c=a.length;var d=a.substring(b+1,c);return d.toLowerCase()},'getTypeClass':function(a){switch(n.getFileType(a)){case'xls':case'xlsx':return'file-excel-o';break;case'pdf':return'file-pdf-o';break;case'mp3':case'rm':case'ogg':case'mid':case'wav':return'file-sound-o';break;case'doc':case'docx':return'file-word-o';break;case'zip':case'rar':case'7z':return'file-archive-o';break;case'jpg':case'png':case'gif':return'file-image-o';break;case'txt':case'html':case'htm':return'file-text-o';break;case'avi':case'wma':case'rmvb':case'mp4':case'3gp':case'flash':return'file-movie-o';break;case'ppt':case'pptx':return'file-powerpoint-o';break;case'c':case'cpp':case'js':case'php':case'py':return'file-powerpoint-o';break;default:return'file-o';break}},};var o=function(configs={}){configs=$.extend(g,configs);var h=this;var i=h.find('.lqUploader-button');var j=h.find('.lqUploader-input');var k=h.find('.lqUploader-filelist');var l=function(d){var e=new FormData();e.append(configs.uploadName,d);for(var f in configs.paramList){e.append(f,configs.paramList[f])}$.ajax({'url':configs.uploadScript,'method':configs.method,'data':e,'processData':false,'contentType':false,'success':function(a,b){var c=configs.handleUploadData(a);if(c.result){n.addFile(k,d.name,d.size,c.fileId);configs.onUploadSuccess()}else{configs.onUploadError(c.msg)}},'error':function(a,b,c){configs.onUploadError(b)}})};var m=function(d){var e=$.extend({'fileId':d},configs.deleteParamList);$.ajax({'url':configs.deleteScript,'method':configs.method,'data':e,'success':function(a,b){var c=configs.handleDeleteData(a);if(c.result){n.deleteFile(k,d);configs.onDeleteSuccess()}else{configs.onDeleteError(c.msg)}},'error':function(a,b,c){configs.onDeleteError(b)}})};i.click(function(){j.trigger('click')});j.change(function(){var a=j.get(0).files;if(a.length==0){return false}var b=a[0];configs.onSelectFile(b);if(configs.maxFileSize>0&&b.size>configs.maxFileSize){configs.onMaxFileSize(b.size);return false}var c=n.getFileType(b.name);if(configs.typeList.length>0&&configs.typeList.indexOf(c)<0){configs.onTypeError(c);return false}l(b);j.val('');return true});k.on('click','.lqUploader-delete',function(){var a=$(this).parent().data('fileId');m(a)})};$.fn.extend({'lqUploader':o,})})(jQuery);